<!-- calculator.html -->
<section id="calculator" class="section">
    <div class="container">
        <!-- Хлебные крошки -->
        <div class="breadcrumbs">
            <a href="https://arenda-kovrov-mirum.ru/">Главная</a>
            <span>/</span>
            <a href="#calculator">Калькулятор стоимости</a>
        </div>
        
        <!-- Быстрые ссылки -->
        <div class="quick-links">
            <a href="#standard-calculator" class="quick-link">Стандартный расчет</a>
            <a href="#tender-calculator" class="quick-link">Тендерный расчет</a>
            <a href="#requisites" class="quick-link">Реквизиты</a>
            <a href="#contract" class="quick-link">Договор</a>
        </div>

        <h2 class="section-title">Калькулятор стоимости</h2>
        
        <div class="calculator-section">
            <div class="calculator-tabs">
                <button class="tab-btn active" data-tab="standard">Стандартные ковры</button>
                <button class="tab-btn" data-tab="tender">Тендерный калькулятор</button>
            </div>
            
            <!-- Стандартный калькулятор -->
            <div id="standard-calculator" class="calculator-content active">
                <form id="standard-form">
                    <div class="form-group">
                        <label for="region">Регион</label>
                        <select id="region" name="region" onchange="updateSizes()">
                            <option value="">Выберите регион</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="size">Размер ковра</label>
                        <select id="size" name="size" disabled onchange="updateFrequencies()">
                            <option value="">Сначала выберите регион</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="frequency">Периодичность замены</label>
                        <select id="frequency" name="frequency" disabled onchange="calculate()">
                            <option value="">Сначала выберите размер</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="quantity">Количество ковров</label>
                        <input type="number" id="quantity" name="quantity" min="1" value="1" 
                               onchange="calculate()" oninput="calculate()">
                    </div>
                    
                    <!-- ДОБАВЛЕНА КНОПКА РАСЧЕТА -->
                    <button type="button" class="btn" onclick="calculate()">Рассчитать</button>
                    
                    <button type="button" class="btn" onclick="addPosition()">Добавить позицию</button>
                    
                    <div id="addedNotice" style="display: none;">
                        Позиция добавлена! Вы можете продолжить добавлять ковры для этого же региона или изменить параметры выше.
                    </div>
                    
                    <div id="standard-result" style="display: none;">
                        <h3>Ваш заказ</h3>
                        <table id="orderTable">
                            <thead>
                                <tr>
                                    <th>Размер</th>
                                    <th>Кол-во</th>
                                    <th>Замена</th>
                                    <th>Цена за 1 замену</th>
                                    <th>Стоимость за 4 недели</th>
                                </tr>
                            </thead>
                            <tbody id="orderBody">
                                <!-- Здесь будут добавляться позиции -->
                            </tbody>
                        </table>
                        
                        <div id="total">Общая стоимость: 0 ₽</div>
                        
                        <div id="discountNotice" style="display: none;">
                            <p>Это предварительный расчет, напишите нам в WhatsApp, мы сделаем более выгодное предложение.</p>
                        </div>
                        
                        <div id="discountSection" style="display: none;">
                            <h3>Запросить скидку</h3>
                            <div class="form-group">
                                <label for="name">Ваше имя*</label>
                                <input type="text" id="name" name="name" placeholder="Иван Иванов" required>
                            </div>
                            <div class="form-group">
                                <label for="discountPhone">Телефон*</label>
                                <input type="tel" id="discountPhone" name="discountPhone" placeholder="+7 (999) 123-45-67" required>
                            </div>
                            
                            <div class="consent-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="consent" name="consent" required>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Я согласен на <a class="privacy-link" onclick="openPrivacyModal()">обработку персональных данных</a></span>
                            </div>
                            
                            <button type="button" class="btn" onclick="requestDiscount()">Отправить запрос</button>
                        </div>
                        
                        <div style="margin-top: 30px; display: flex; flex-wrap: wrap;">
                            <button type="button" class="btn btn-whatsapp" onclick="sendToWhatsApp()">
                                <i class="fab fa-whatsapp" style="margin-right: 8px;"></i> Написать в WhatsApp
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="showContractForm()">Отправить реквизиты</button>
                        </div>
                        
                        <div class="requisites-form" id="contractForm" style="display: none;">
                            <h3>Реквизиты для договора</h3>
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="company">Название организации</label>
                                        <input type="text" id="company" name="company" placeholder="ООО 'Ромашка'">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="contact-person">Контактное лицо*</label>
                                        <input type="text" id="contact-person" name="contact-person" placeholder="Иванов Иван Иванович" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="contractPhone">Телефон*</label>
                                        <input type="tel" id="contractPhone" name="contractPhone" placeholder="+7 (999) 123-45-67" required>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="email">Email</label>
                                        <input type="email" id="email" name="email" placeholder="example@mail.ru">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="requisites">Реквизиты компании (ИНН, ОГРН, КПП, почтовый адрес):</label>
                                <textarea id="requisites" name="requisites" style="min-height: 100px; resize: vertical;"></textarea>
                            </div>
                            
                            <div class="file-upload" style="margin: 15px 0;">
                                <label style="display: block; margin-bottom: 10px; font-weight: 600;">Или прикрепите реквизиты файлом</label>
                                <input type="file" id="requisitesFile" name="requisitesFile">
                            </div>
                            
                            <div class="consent-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="contractConsent" name="contractConsent" required>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Я согласен на <a class="privacy-link" onclick="openPrivacyModal()">обработку персональных данных</a></span>
                            </div>
                            
                            <button type="button" class="btn" onclick="sendContractDetails()">Отправить реквизиты</button>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Тендерный калькулятор -->
            <div id="tender-calculator" class="calculator-content">
                <form id="tender-form">
                    <div class="form-group">
                        <label for="tenderRegion">Регион</label>
                        <select id="tenderRegion" name="tenderRegion" onchange="updateTenderSizes()">
                            <option value="">Выберите регион</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="tenderSize">Размер ковра</label>
                        <select id="tenderSize" name="tenderSize" disabled onchange="calculateTender()">
                            <option value="">Сначала выберите регион</option>
                        </select>
                    </div>
                    
                    <button type="button" class="btn" onclick="addTenderPosition()">Добавить позицию</button>
                    
                    <div class="month-inputs" id="monthInputs">
                        <!-- Месячные поля будут добавлены динамически -->
                    </div>
                    
                    <div id="tender-result" style="display: none;">
                        <h3>Расчет по тендеру</h3>
                        <table id="tenderTable">
                            <thead>
                                <tr>
                                    <th>Месяц</th>
                                    <th>Размер</th>
                                    <th>Кол-во ковров</th>
                                    <th>Кол-во замен</th>
                                    <th>Стоимость</th>
                                </tr>
                            </thead>
                            <tbody id="tenderBody">
                                <!-- Здесь будут добавляться позиции -->
                            </tbody>
                        </table>
                        
                        <div id="tenderTotal">Общая стоимость по контракту: 0 ₽</div>
                        
                        <div id="tenderDiscountNotice" style="display: none;">
                            <p>Это предварительный расчет, напишите нам в WhatsApp, мы сделаем более выгодное предложение.</p>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <div class="form-group">
                                <label for="tenderName">Ваше имя*</label>
                                <input type="text" id="tenderName" name="tenderName" placeholder="Иван Иванов" required>
                            </div>
                            <div class="form-group">
                                <label for="tenderPhone">Телефон*</label>
                                <input type="tel" id="tenderPhone" name="tenderPhone" placeholder="+7 (999) 123-45-67" required>
                            </div>
                            
                            <div class="consent-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="tenderConsent" name="tenderConsent" required>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Я согласен на <a class="privacy-link" onclick="openPrivacyModal()">обработку персональных данных</a></span>
                            </div>
                            
                            <button type="button" class="btn btn-whatsapp" onclick="sendTenderToWhatsApp()">
                                <i class="fab fa-whatsapp" style="margin-right: 8px;"></i> Отправить в WhatsApp
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>